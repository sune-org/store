[{"id":"zp2je1g","name":"Github Fetch","pinned":false,"avatar":"data:image/webp;base64,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","url":"gh://sune-org/store/github-utilities/fetch.sune","updatedAt":1763523682213,"settings":{"model":"","temperature":"","top_p":"","top_k":"","frequency_penalty":"","repetition_penalty":"","min_p":"","top_a":"","verbosity":"","reasoning_effort":"default","system_prompt":"","html":"<div id=\"ghFetchSune\" class=\"p-1.5 bg-slate-100 rounded-lg shadow-sm font-sans\" x-data>\n  <div class=\"flex items-center justify-between\">\n    <div class=\"flex items-center gap-1.5\">\n      <i data-lucide=\"github\" class=\"h-4 w-4 text-slate-600\"></i>\n      <span class=\"text-xs font-medium text-slate-800\">GitHub Fetch</span>\n      <span class=\"text-[10px] text-slate-400\">v1.9.5</span>\n    </div>\n    <div class=\"flex items-center gap-1\">\n      <button id=\"ghFetchAllBtn\" type=\"button\" class=\"rounded-md px-2 py-1 text-xs font-semibold bg-slate-800 text-white hover:bg-slate-700 active:scale-95 transition-all\">\n        Fetch All\n      </button>\n      <button type=\"button\" id=\"ghAddRowBtn\" class=\"h-7 w-7 rounded-md bg-slate-200/80 text-slate-600 hover:bg-white active:shadow-inner active:scale-95 flex items-center justify-center transition-all\" title=\"Add URL\">\n        <i data-lucide=\"plus\" class=\"h-4 w-4\"></i>\n      </button>\n    </div>\n  </div>\n\n  <div id=\"ghRows\" class=\"mt-2 space-y-1.5\"></div>\n  <div id=\"ghStatus\" class=\"mt-1.5 px-1 text-[11px] text-slate-600 min-h-[1em]\"></div>\n</div>\n\n<script>\n(()=>{\n  const root=document.getElementById('ghFetchSune');\n  if(!root)return;\n\n  const $=s=>root.querySelector(s);\n\n  const els={\n    rows:$('#ghRows'),\n    add:$('#ghAddRowBtn'),\n    all:$('#ghFetchAllBtn'),\n    status:$('#ghStatus')\n  };\n\n  const cache={};\n\n  const icons=()=>{\n    try{lucide.createIcons({attrs:{'aria-hidden':!0}});}catch(e){}\n  };\n\n  const getKey=()=>'gh_fetch_sune_shared_urls_v1';\n  const getIgnoreKey=()=>'gh_fetch_sune_shared_ignores_v1';\n\n  const load=()=>{\n    try{\n      const d=JSON.parse(localStorage.getItem(getKey()));\n      return Array.isArray(d)?d.map(x=>String(x||'')):[''];\n    }catch{return[''];}\n  };\n\n  const loadIgnores=()=>{\n    try{\n      const d=JSON.parse(localStorage.getItem(getIgnoreKey()));\n      return Array.isArray(d)?d.map(x=>String(x||'')):[];\n    }catch{return[];}\n  };\n\n  const save=d=>localStorage.setItem(getKey(),JSON.stringify(d.map(u=>(u||'').trim())));\n  const saveIgnores=ig=>localStorage.setItem(getIgnoreKey(),JSON.stringify(ig.map(v=>String(v||''))));\n\n  const setStatus=(el,msg,kind)=>{\n    const k={error:'text-red-600',ok:'text-emerald-600',info:el.id==='ghStatus'?'text-slate-600':'text-slate-500'};\n    el.textContent=msg||'';\n    el.className=`${el.dataset.baseClass} ${k[kind]||k.info}`;\n  };\n\n  const setGlobalStatus=(m,k='info')=>setStatus(els.status,m,k);\n  const setRowStatus=(i,m,k='info')=>{\n    const n=$(`[data-role=\"row-status\"][data-index=\"${i}\"]`);\n    if(n)setStatus(n,m,k);\n  };\n\n  const spinner=c=>`<svg class=\"animate-spin ${c}\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\" fill=\"none\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8v4A4 4 0 004 12z\"></path></svg>`;\n\n  const ghFetch=async(url,opts={})=>{\n    const h=opts.headers||{};\n    if(window.globalStore?.ghToken)h.Authorization=`Bearer ${window.globalStore.ghToken}`;\n    const res=await fetch(url,{...opts,headers:h});\n    if(!res.ok)throw new Error(`Request failed: HTTP ${res.status}`);\n    return res;\n  };\n\n  const getInfo=async(o,r)=>{\n    const k=`${o}/${r}`;\n    if(cache[k])return cache[k];\n    const d=await(await ghFetch(`https://api.github.com/repos/${o}/${r}`)).json();\n    if(!d.default_branch)throw new Error('No default branch.');\n    return cache[k]=d;\n  };\n\n  async function parse(u){\n    try{\n      const lM=u.match(/#L(\\d+)(?:-L(\\d+))?$/i);\n      const lines=lM?{start:+lM[1],end:+lM[2]||+lM[1]}:null;\n      const urlStr=u.split('#')[0];\n      try{\n        const url=new URL(urlStr);\n        let owner,repo,ref,path;\n        if(url.hostname==='github.com'){\n          const p=url.pathname.split('/').filter(Boolean);\n          if(p.length>=4&&(p[2]==='blob'||p[2]==='raw')){\n            [owner,repo,,ref]=p;\n            path=p.slice(4).join('/');\n            return{type:'file',p:{owner,repo,ref,path,lines,raw:`https://raw.githubusercontent.com/${owner}/${repo}/${ref}/${path}`}};\n          }\n        }else if(url.hostname==='raw.githubusercontent.com'){\n          const p=url.pathname.split('/').filter(Boolean);\n          if(p.length>=4){\n            [owner,repo,ref]=p;\n            path=p.slice(3).join('/');\n            return{type:'file',p:{owner,repo,ref,path,lines,raw:url.href}};\n          }\n        }\n      }catch(e){}\n      const p=urlStr.split('/').filter(Boolean);\n      if(p.length>=2){\n        const[owner,repo]=p;\n        if(p.length>2){\n          const path=p.slice(2).join('/');\n          const{default_branch:ref}=await getInfo(owner,repo);\n          return{type:'file',p:{owner,repo,ref,path,lines,raw:`https://raw.githubusercontent.com/${owner}/${repo}/${ref}/${path}`}};\n        }\n        const info=await getInfo(owner,repo);\n        return{type:'repo',p:{owner,repo,default_branch:info.default_branch}};\n      }\n    }catch(e){return null;}\n  }\n\n  const isBin=p=>/\\.(png|jpe?g|gif|bmp|webp|ico|tif?f|svg|zip|rar|7z|tar|gz|bz2|xz|pdf|docx?|xlsx?|pptx?|mp[34]|wav|ogg|webm|mov|avi|mkv|woff2?|ttf|otf|eot|exe|dll|so|dylib|bin|o|a|class|jar|pyc|iso|img|dmg)$/i.test(p);\n  const getLang=p=>(p.split('.').pop()||'').toLowerCase();\n  const getFence=s=>'`'.repeat(Math.max(3,1+Math.max(0,...(s.match(/`+/g)||[]).map(x=>x.length))));\n\n  const fetchFile=async({raw,path,lines,owner,repo,ref})=>{\n    const h=`[${owner}/${repo}@${ref}/${path}](https://github.com/${owner}/${repo}/blob/${ref}/${path})`;\n    if(isBin(path))return{md:`${h}\\n\\n*Binary file - content not displayed.*`};\n    let content=await(await ghFetch(raw,{cache:'no-store'})).text();\n    let fileContentMd;\n    if(path.toLowerCase().endsWith('.sune')){\n      try{\n        const d=JSON.parse(content);\n        const html=d?.[0]?.settings?.html;\n        if(typeof html==='string'){\n          const fence=getFence(html);\n          fileContentMd=`${fence}html\\n${html}\\n${fence}`;\n        }\n      }catch(e){}\n    }\n    if(!fileContentMd){\n      if(lines)content=content.replace(/\\r\\n/g,'\\n').split('\\n').slice(lines.start-1,lines.end).join('\\n');\n      const fence=getFence(content);\n      fileContentMd=`${fence}${getLang(path)}\\n${content}\\n${fence}`;\n    }\n    return{md:`${h}\\n\\n${fileContentMd}`};\n  };\n\n  const matchIgnore=(path,patterns)=>{\n    if(!patterns?.length)return!1;\n    let ignore=false;\n    for(const raw of patterns){\n      const s=(raw||'').trim();\n      if(!s||s.startsWith('#'))continue;\n      const negative=s[0]==='!';\n      const pat=negative?s.slice(1):s;\n      if(!pat)continue;\n\n      let q=pat.replace(/[.+^${}()|[\\]\\\\]/g,'\\\\$&');\n      q=q.replace(/\\\\\\*\\\\\\*/g,'.*');\n      q=q.replace(/\\\\\\*/g,'[^/]*');\n\n      let reg;\n      if(pat.startsWith('/')){\n        const core=q.slice(2);\n        if(pat.endsWith('/')) reg=`^${core}.*`;\n        else reg=`^${core}(/.*)?$`;\n      }else{\n        if(pat.endsWith('/')) reg=`(^|/)${q}.*`;\n        else reg=`(^|/)${q}(/.*)?$`;\n      }\n      try{\n        if(new RegExp(reg).test(path)) ignore=!negative;\n      }catch(e){}\n    }\n    return ignore;\n  };\n\n  const runPool=async(jobs,limit,onProgress)=>{\n    const out=new Array(jobs.length);\n    let next=0,active=0;\n    return new Promise(resolve=>{\n      const kick=()=>{\n        if(next>=jobs.length&&!active){resolve(out);return;}\n        while(active<limit&&next<jobs.length){\n          const i=next++;\n          active++;\n          jobs[i]().then(r=>{out[i]=r;}).catch(e=>{out[i]={error:e};}).finally(()=>{active--;onProgress&&onProgress(i,out[i]);kick();});\n        }\n      };\n      kick();\n    });\n  };\n\n  const post=async md=>{\n    if(window.USER?.logMany&&Array.isArray(md))return window.USER.logMany(md);\n    if(window.USER?.log){\n      if(Array.isArray(md)){for(const m of md)await window.USER.log(m);return;}\n      return window.USER.log(md);\n    }\n    return new Error('Chat injection failed.');\n  };\n\n  const fetchRepo=async({owner,repo,default_branch},i,ignoreStr)=>{\n    setRowStatus(i,'Fetching tree...');\n    const{commit:{sha}}=await(await ghFetch(`https://api.github.com/repos/${owner}/${repo}/branches/${default_branch}`)).json();\n    const{tree,truncated}=await(await ghFetch(`https://api.github.com/repos/${owner}/${repo}/git/trees/${sha}?recursive=1`)).json();\n    if(truncated)throw new Error('Repo too large to fetch completely.');\n    \n    const allFiles=tree.filter(n=>n.type==='blob');\n    if(!allFiles.length)throw new Error('No files found in repo.');\n\n    const ignorePatterns=(ignoreStr||'').split('\\n').map(s=>s.trim()).filter(Boolean);\n    const targets=allFiles.filter(f=>!matchIgnore(f.path,ignorePatterns));\n\n    if(!targets.length)throw new Error('All files ignored by patterns.');\n\n    const total=targets.length;\n    let completed=0,posted=0;\n    const skipped=allFiles.length-total;\n\n    const jobs=targets.map(({path})=>async()=>{\n      const h=`[${owner}/${repo}@${default_branch}/${path}](https://github.com/${owner}/${repo}/blob/${default_branch}/${path})`;\n      if(isBin(path))return{ok:true,md:`${h}\\n\\n*Binary file - content not displayed.*`,path};\n      try{\n        let content=await(await ghFetch(`https://raw.githubusercontent.com/${owner}/${repo}/${sha}/${path}`)).text();\n        let fileContentMd;\n        if(path.toLowerCase().endsWith('.sune')){\n          try{\n            const d=JSON.parse(content);\n            const html=d?.[0]?.settings?.html;\n            if(typeof html==='string'){\n              const fence=getFence(html);\n              fileContentMd=`${fence}html\\n${html}\\n${fence}`;\n            }\n          }catch(e){}\n        }\n        if(!fileContentMd){\n          const fence=getFence(content);\n          fileContentMd=`${fence}${getLang(path)}\\n${content}\\n${fence}`;\n        }\n        return{ok:true,md:`${h}\\n\\n${fileContentMd}`,path};\n      }catch(error){\n        return{ok:false,md:`${h}\\n\\n*Error posting file: ${error.message||error}*`,path};\n      }\n    });\n\n    const results=await runPool(jobs,6,(index)=>{\n      completed++;\n      if(completed<=total)setRowStatus(i,`Fetching ${completed}/${total}: ${targets[index]?.path||''}`,'info');\n    });\n\n    const okMessages=[],errorMessages=[];\n    for(const r of results){\n      if(!r||!r.md)continue;\n      if(r.ok){okMessages.push(r.md);posted++;}\n      else errorMessages.push(r.md);\n    }\n\n    if(okMessages.length){\n      setRowStatus(i,'Posting fetched files...','info');\n      await post(okMessages);\n    }\n    if(errorMessages.length)await post(errorMessages);\n    return{s:posted,t:total,skipped};\n  };\n\n  const urls=load();\n  const ignores=loadIgnores();\n  const esc=s=>String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/\"/g,'&quot;');\n\n  const rowTpl=(i,v='')=>{\n    const ig=(ignores[i]||'').trim();\n    const preview=ig?'Ignore: '+ig.replace(/\\n/g,'; '):'';\n    return`<div><div class=\"flex items-stretch gap-1\"><input data-role=\"url\" data-index=\"${i}\" type=\"text\" placeholder=\"user/repo or user/repo/file or full URL...\" class=\"flex-1 min-w-0 rounded-md border-0 bg-white shadow-inner px-2.5 py-1.5 text-xs text-slate-800 placeholder:text-slate-400 focus:ring-2 focus:ring-slate-400 transition\" value=\"${esc(v)}\"><button data-role=\"copy\" data-index=\"${i}\" type=\"button\" class=\"shrink-0 rounded-md w-8 bg-slate-200/80 text-slate-600 hover:bg-white active:shadow-inner active:scale-95 flex items-center justify-center transition-all\" title=\"Copy URL\"><i data-lucide=\"copy\" class=\"h-4 w-4\"></i></button><button data-role=\"ignore\" data-index=\"${i}\" type=\"button\" class=\"shrink-0 rounded-md w-8 bg-slate-200/80 text-slate-600 hover:bg-white active:shadow-inner active:scale-95 flex items-center justify-center transition-all\" title=\"Edit ignore patterns\"><i data-lucide=\"filter\" class=\"h-4 w-4\"></i></button><button data-role=\"fetch-one\" data-index=\"${i}\" type=\"button\" class=\"shrink-0 rounded-md px-2.5 text-xs font-semibold bg-slate-800 text-white hover:bg-slate-700 active:scale-95 transition-all\">Fetch</button><button data-role=\"remove\" data-index=\"${i}\" type=\"button\" class=\"shrink-0 rounded-md w-8 text-slate-500 bg-slate-200/80 hover:bg-red-100 hover:text-red-600 active:scale-95 flex items-center justify-center transition-all\" title=\"Remove\"><i data-lucide=\"trash-2\" class=\"h-4 w-4\"></i></button></div><div data-role=\"ignore-preview\" data-index=\"${i}\" class=\"mt-0.5 px-1 text-[10px] text-slate-400 min-h-[0.75em] truncate\">${esc(preview)}</div><div data-role=\"row-status\" data-index=\"${i}\" data-base-class=\"mt-0.5 px-1 text-[11px] min-h-[1em]\" class=\"mt-0.5 px-1 text-[11px] text-slate-500 min-h-[1em]\"></div></div>`;\n  };\n\n  const render=()=>{\n    els.rows.innerHTML=(urls.length?urls:['']).map((u,i)=>rowTpl(i,u)).join('');\n    icons();\n  };\n\n  async function fetchRow(i){\n    const inp=$(`[data-role=\"url\"][data-index=\"${i}\"]`),btn=$(`[data-role=\"fetch-one\"][data-index=\"${i}\"]`);\n    if(!inp||!btn)return!1;\n    setRowStatus(i,'');\n    const url=(inp.value||'').trim();\n    if(!url){setRowStatus(i,'Please enter a path or URL.','error');return!1;}\n    const prev=btn.innerHTML;btn.innerHTML=spinner('h-4 w-4');btn.disabled=!0;inp.disabled=!0;\n    try{\n      setRowStatus(i,'Parsing...','info');\n      const parsed=await parse(url);\n      if(!parsed)throw new Error('Invalid URL or repo not found.');\n      if(parsed.type==='file'){\n        const result=await fetchFile(parsed.p);\n        await post(result.md);\n        setRowStatus(i,'Added to chat.','ok');\n      }else{\n        const{s,t,skipped}=await fetchRepo(parsed.p,i,ignores[i]||'');\n        const ignoredInfo=skipped?`, ignored ${skipped}`:'';\n        setRowStatus(i,s===t&&t>0&&!skipped?`Added all ${t} files.`:`Added ${s}/${t} files${ignoredInfo}.`,s===t&&t>0&&!skipped?'ok':'info');\n      }\n      return!0;\n    }catch(err){setRowStatus(i,err.message||String(err),'error');return!1;}finally{btn.innerHTML=prev;btn.disabled=!1;inp.disabled=!1;}\n  }\n\n  els.rows.addEventListener('click',async e=>{\n    const b=e.target.closest('button[data-role]');\n    if(!b)return;\n    const i=+b.dataset.index;\n    const actions={\n      copy:async()=>{\n        const n=$(`input[data-index=\"${i}\"]`);\n        if(!n?.value){setRowStatus(i,'Nothing to copy.');return;}\n        try{await navigator.clipboard.writeText(n.value);setRowStatus(i,'Copied!','ok');}catch(e){setRowStatus(i,'Copy failed.','error');}\n      },\n      ignore:()=>{\n        const cur=(ignores[i]||'').replace(/\\n/g,', ');\n        const hint='Patterns like .gitignore.\\nExamples:\\nnode_modules/\\n**/secret.txt\\n*.log';\n        const next=prompt(hint,cur);\n        if(next===null)return;\n        const normalized=(next||'').split(/[,;]+/).map(s=>s.trim()).filter(Boolean).join('\\n');\n        ignores[i]=normalized;\n        while(ignores.length<urls.length)ignores.push('');\n        saveIgnores(ignores);\n        const pv=$(`[data-role=\"ignore-preview\"][data-index=\"${i}\"]`);\n        if(pv)pv.textContent=normalized?'Ignore: '+normalized.replace(/\\n/g,'; '):'';\n      },\n      'fetch-one':()=>fetchRow(i),\n      remove:()=>{\n        if(urls.length>1){urls.splice(i,1);ignores.splice(i,1);}else{urls[0]='';ignores[0]='';}\n        save(urls);saveIgnores(ignores);render();\n      }\n    };\n    if(actions[b.dataset.role])actions[b.dataset.role]();\n  });\n\n  els.rows.addEventListener('input',e=>{\n    const n=e.target.closest('input[data-role=\"url\"]');\n    if(!n)return;\n    urls[+n.dataset.index]=n.value;\n    save(urls);\n  });\n\n  els.rows.addEventListener('keydown',e=>{\n    if(e.key!=='Enter'||!e.target.matches('input[data-role=\"url\"]'))return;\n    e.preventDefault();\n    fetchRow(+e.target.dataset.index);\n  });\n\n  els.add.addEventListener('click',()=>{\n    urls.push('');ignores.push('');save(urls);saveIgnores(ignores);render();\n    const inp=$(`input[data-index=\"${urls.length-1}\"]`);\n    if(inp)inp.focus();\n  });\n\n  els.all.addEventListener('click',async()=>{\n    const list=urls.map((u,i)=>({u:u.trim(),i})).filter(x=>x.u);\n    if(!list.length){setGlobalStatus('No URLs to fetch. Add one with +.','error');return;}\n    const prev=els.all.innerHTML;els.all.innerHTML=spinner('h-4 w-4');els.all.disabled=!0;\n    setGlobalStatus(`Fetching ${list.length} item(s)...`,'info');\n    let s=0,f=0;\n    for(const{i}of list)(await fetchRow(i))?s++:f++;\n    els.all.innerHTML=prev;els.all.disabled=!1;\n    setGlobalStatus(!f?`Fetched ${s} item(s) successfully.`:`Completed: ${s} succeeded, ${f} failed.`,!f?'ok':'error');\n  });\n\n  els.status.dataset.baseClass='mt-1.5 px-1 text-[11px] min-h-[1em]';\n  render();\n})();\n</script>\n","extension_html":"<sune src='https://raw.githubusercontent.com/sune-org/store/refs/heads/main/sync.sune' private></sune>","hide_composer":false,"include_thoughts":false,"json_output":false,"ignore_master_prompt":false,"json_schema":"","presence_penalty":0,"max_tokens":0},"storage":{}}]